generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                      String                   @id @default(cuid())
  name                    String?
  lastName                String?
  email                   String?                  @unique
  phone                   String?
  address                 Json?
  about                   String?
  emailVerified           DateTime?
  image                   String?
  password                String?
  status                  UserStatus               @default(Active)
  role                    UserRole                 @default(User)
  isTwoFactorEnabled      Boolean                  @default(false)
  cpf                     String?
  twoFactorMethod         TwoFactorMethod          @default(NONE)
  accounts                Account[]
  KanbanTaskAssignee      KanbanTaskAssignee[]
  notificationPreferences NotificationPreferences?
  orders                  Order[]
  projectRequests         ProjectRequest[]
  restockWishes           RestockWish[]
  reviews                 Review[]
  sessions                Session[]
  twoFactorConfirmation   TwoFactorConfirmation?
  notifications           UserNotification[]
  UserTotpCredential      UserTotpCredential?
  appointments            Appointment[]
  stockMovements          StockMovement[]

  @@index([email])
}

model UserNotification {
  id                String    @id @default(cuid())
  title             String
  message           String
  createdAt         DateTime  @default(now())
  userId            String
  deliveredAt       DateTime?
  metadata          Json?
  updatedAt         DateTime  @updatedAt
  attemptedChannels String[]
  deliveredChannels String[]
  errorMessage      String?
  failedChannels    String[]
  type              String
  status            String    @default("pending")
  priority          String    @default("normal")
  image             String?
  read              Boolean   @default(false)
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
}

model NotificationPreferences {
  id                   String   @id @default(cuid())
  userId               String   @unique
  soundEnabled         Boolean  @default(true)
  volume               Int      @default(80)
  dndEnabled           Boolean  @default(false)
  dndStartTime         String?
  dndEndTime           String?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  enableBrowser        Boolean  @default(false)
  enableEmail          Boolean  @default(true)
  enableInApp          Boolean  @default(true)
  enableTelegram       Boolean  @default(false)
  enableWhatsapp       Boolean  @default(false)
  granularSettings     Json?
  dndDays              String[]
  telegramChatId       String?  @unique
  whatsappNumber       String?
  telegramConnectToken String?  @unique
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([telegramChatId])
  @@index([whatsappNumber])
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model VerificationToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model PasswordResetToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model TwoFactorToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model TwoFactorConfirmation {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Post {
  id                String        @id @default(cuid())
  slug              String        @unique
  title             String
  description       String
  content           String
  publish           Boolean
  metaTitle         String?
  metaDescription   String?
  metaKeywords      String[]
  imageUrl          String
  tags              String[]
  postCategoryId    String?
  postSubCategoryId String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  author            String
  readTime          Int?
  category          PostCategory? @relation(fields: [postCategoryId], references: [id])

  @@index([slug])
}

model PostCategory {
  id          String   @id @default(cuid())
  slug        String   @unique
  name        String
  imageUrl    String?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  posts       Post[]

  @@index([slug])
  @@map("postCategories")
}

model Lead {
  id         String    @id @default(cuid())
  name       String
  phone      String
  isWhatsApp Boolean?  @default(false)
  email      String?
  message    String?
  bestTime   String?
  date       DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@map("leads")
}

model Settings {
  id                  String   @id @default(cuid())
  contactConfig       Json?
  socialMediaConfig   Json?
  externalLinksConfig Json?
  address             Json?
  contact             Json?
  googleAnalyticsId   String?
  googleTagManagerId  String?
  metaPixelId         String?
  privacyPolicy       String?
  termsOfUse          String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  imagesConfig        Json?
  externalLinks       Json?
  images              Json?
  socialMedia         Json?
  shopSettings        Json?
  shippingSettings    Json?
}

model Product {
  sortOrder       Int                  @default(0)
  id              String               @id @default(cuid())
  slug            String               @unique
  name            String
  type            ProductType
  status          ProductStatus
  visibility      ProductVisibility
  description     String?
  content         String?
  categoryId      String?
  properties      Json?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  metaDescription String?
  metaTitle       String?
  tags            String[]
  reviews         Review[]
  options         OptionsOnProducts[]
  variations      ProductVariation[]
  images          ProductImage[]
  attributes      AttributeOnProduct[]
  category        ProductCategory?     @relation(fields: [categoryId], references: [id])
  collections     Collection[]         @relation("CollectionProducts")

  @@index([slug])
  @@map("products")
}

model ProductVariation {
  id             String               @id @default(cuid())
  sku            String?              @unique
  price          Decimal              @db.Decimal(10, 2)
  salePrice      Decimal?             @db.Decimal(10, 2)
  stock          Int                  @default(0)
  stockStatus    StockStatus          @default(IN_STOCK)
  stockAlert     Int?
  weight         Float?
  width          Float?
  height         Float?
  depth          Float?
  productId      String
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  idealStock     Int?
  product        Product              @relation(fields: [productId], references: [id], onDelete: Cascade)
  images         ProductImage[]
  stockMovements StockMovement[]
  optionValues   ProductOptionValue[] @relation("ProductOptionValueToProductVariation")

  @@map("productVariations")
}

model StockMovement {
  id          String            @id @default(cuid())
  variationId String
  type        StockMovementType
  quantity    Int
  reason      String?
  userId      String
  createdAt   DateTime          @default(now())
  user        User              @relation(fields: [userId], references: [id])
  variation   ProductVariation  @relation(fields: [variationId], references: [id], onDelete: Cascade)

  @@index([variationId, createdAt])
  @@index([userId, createdAt])
  @@map("stockMovements")
}

model ProductImage {
  id          String            @id @default(cuid())
  url         String
  altText     String?
  role        ImageRole         @default(GALLERY)
  order       Int               @default(0)
  productId   String
  variationId String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  product     Product           @relation(fields: [productId], references: [id], onDelete: Cascade)
  variation   ProductVariation? @relation(fields: [variationId], references: [id])

  @@index([productId])
  @@index([variationId])
  @@map("product_images")
}

model OptionsOnProducts {
  productId String
  optionId  String         @map("attributeId")
  order     Int            @default(0)
  option    ProductOptions @relation(fields: [optionId], references: [id])
  product   Product        @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@id([productId, optionId])
  @@map("optionsOnProducts")
}

model ProductAttribute {
  id            String                  @id @default(cuid())
  name          String
  slug          String                  @unique
  showInFilter  Boolean                 @default(true)
  showInProduct Boolean                 @default(true)
  order         Int                     @default(0)
  createdAt     DateTime                @default(now())
  updatedAt     DateTime                @updatedAt
  values        ProductAttributeValue[]
  productValues AttributeOnProduct[]

  @@map("product_attributes")
}

model ProductAttributeValue {
  id          String               @id @default(cuid())
  value       String
  label       String?
  attributeId String
  order       Int                  @default(0)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
  attribute   ProductAttribute     @relation(fields: [attributeId], references: [id], onDelete: Cascade)
  products    AttributeOnProduct[]

  @@unique([attributeId, value])
  @@map("product_attribute_values")
}

model AttributeOnProduct {
  id                 String                @id @default(cuid())
  productId          String
  valueId            String
  createdAt          DateTime              @default(now())
  productAttributeId String?
  productAttribute   ProductAttribute?     @relation(fields: [productAttributeId], references: [id])
  product            Product               @relation(fields: [productId], references: [id], onDelete: Cascade)
  value              ProductAttributeValue @relation(fields: [valueId], references: [id])

  @@unique([productId, valueId])
  @@map("product_product_attributes")
}

model ProductOptions {
  id              String               @id @default(cuid())
  name            String
  order           Int                  @default(0)
  type            AttributeTypes       @default(DEFAULT)
  productPageType ProductPageType      @default(DEFAULT)
  filterPageType  FilterPageType       @default(DEFAULT)
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  products        OptionsOnProducts[]
  values          ProductOptionValue[]

  @@map("productOptions")
}

model ProductOptionValue {
  id         String             @id @default(cuid())
  name       String
  label      String?
  value      String
  order      Int                @default(0)
  optionId   String             @map("optionId")
  createdAt  DateTime           @default(now())
  updatedAt  DateTime           @updatedAt
  option     ProductOptions     @relation(fields: [optionId], references: [id], onDelete: Cascade)
  variations ProductVariation[] @relation("ProductOptionValueToProductVariation")

  @@map("productOptionValues")
}

model ProductCategory {
  id          String            @id @default(cuid())
  slug        String            @unique
  name        String
  imageUrl    String?
  description String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  parentId    String?
  order       Int               @default(0)
  visibility  Boolean           @default(true)
  parent      ProductCategory?  @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children    ProductCategory[] @relation("CategoryHierarchy")
  products    Product[]

  @@index([slug])
  @@index([parentId])
  @@index([order])
  @@map("categories")
}

model Review {
  id        String   @id @default(cuid())
  name      String
  image     String?
  platform  String
  rating    Int
  link      String?
  comment   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  productId String?
  userId    String?
  product   Product? @relation(fields: [productId], references: [id])
  user      User?    @relation(fields: [userId], references: [id])
}

model RestockWish {
  id      String   @id @default(cuid())
  product Json
  email   String
  date    DateTime @default(now())
  userId  String?
  user    User?    @relation(fields: [userId], references: [id])
}

model Coupon {
  id                String        @id @default(cuid())
  code              String        @unique
  discountType      DiscountTypes
  startDate         DateTime
  endDate           DateTime?
  usageLimit        Int?
  usageCount        Int           @default(0)
  createdAt         DateTime      @default(now())
  appliesTo         AppliesTo
  description       String?
  isActive          Boolean
  maxDiscountValue  Float?
  minOrderValue     Float?
  targetIds         String[]
  updatedAt         DateTime      @updatedAt
  usageLimitPerUser Int?
  value             Float

  @@map("coupons")
}

model Collection {
  id          String    @id @default(cuid())
  slug        String    @unique
  name        String
  description String?
  imageUrl    String?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  products    Product[] @relation("CollectionProducts")

  @@map("collections")
}

model CartProduct {
  id            String   @id @default(cuid())
  productId     String
  variationId   String
  subAttributes String
  name          String
  image         String
  quantity      Int
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  cartId        String?
  Cart          Cart?    @relation(fields: [cartId], references: [id])
}

model Cart {
  id       String        @id @default(cuid())
  amount   Float
  products CartProduct[]

  @@map("cart")
}

model Order {
  id              String      @id @default(cuid())
  order           Int         @unique @default(autoincrement())
  items           Json?
  address         Json?
  paymentDetails  Json?
  deliveryDetails Json?
  amount          Json?
  history         Json?
  nfe             Json?
  melhorEnvio     Json?
  status          OrderStatus @default(PendingPayment)
  createdAt       DateTime    @default(now())
  customerInfo    Json?
  userId          String?
  user            User?       @relation(fields: [userId], references: [id])
}

model ProjectRequest {
  id           String        @id @default(cuid())
  order        Int           @unique @default(autoincrement())
  info         Json
  status       RequestStatus @default(PENDING_REVIEW)
  projectType  ProjectType
  quote        Json?
  payments     Json?
  deliveryTime Int?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  userId       String?
  user         User?         @relation(fields: [userId], references: [id])
}

model Appointment {
  id               String            @id @default(cuid())
  title            String
  startTime        DateTime
  endTime          DateTime
  status           AppointmentStatus @default(PENDING)
  notes            String?
  userId           String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  customerEmail    String?
  customerName     String?
  customerPhone    String?
  reminderSent     Boolean           @default(false)
  cancellationNote String?
  isPaid           Boolean           @default(false)
  price            Decimal?          @db.Decimal(10, 2)
  user             User?             @relation(fields: [userId], references: [id])

  @@index([startTime, endTime])
  @@map("appointments")
}

model KanbanBoard {
  id        String         @id @default(cuid())
  name      String         @default("Kanban Geral")
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  scope     String         @unique @default("company")
  columns   KanbanColumn[]
  tasks     KanbanTask[]
}

model KanbanColumn {
  id         String       @id @default(cuid())
  boardId    String
  name       String
  orderIndex Int          @default(0)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  board      KanbanBoard  @relation(fields: [boardId], references: [id], onDelete: Cascade)
  tasks      KanbanTask[]

  @@index([boardId, orderIndex])
}

model KanbanTask {
  id                 String               @id @default(cuid())
  boardId            String
  columnId           String
  title              String
  reporter           String?
  labels             String[]
  technology         String[]
  dueDate            DateTime?
  priority           KanbanPriority       @default(MEDIUM)
  description        String?
  attachments        String[]
  sortOrder          Int                  @default(0)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  comments           KanbanComment[]
  subtasks           KanbanSubtask[]
  board              KanbanBoard          @relation(fields: [boardId], references: [id], onDelete: Cascade)
  column             KanbanColumn         @relation(fields: [columnId], references: [id], onDelete: Cascade)
  KanbanTaskAssignee KanbanTaskAssignee[]

  @@index([boardId])
  @@index([columnId, sortOrder])
}

model KanbanSubtask {
  id         String     @id @default(cuid())
  taskId     String
  text       String
  completed  Boolean    @default(false)
  orderIndex Int        @default(0)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  task       KanbanTask @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId, orderIndex])
}

model KanbanComment {
  id        String     @id @default(cuid())
  taskId    String
  content   String
  author    String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  task      KanbanTask @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId, createdAt])
}

model KanbanTaskAssignee {
  taskId     String
  userId     String
  createdAt  DateTime   @default(now())
  KanbanTask KanbanTask @relation(fields: [taskId], references: [id], onDelete: Cascade)
  User       User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([taskId, userId])
  @@index([userId])
}

model ShopSettings {
  id            String   @id
  key           String   @unique @default("default")
  general       Json
  shipping      Json
  payment       Json
  notifications Json
  createdAt     DateTime @default(now())
  updatedAt     DateTime
}

model UserTotpCredential {
  id              String    @id
  userId          String    @unique
  secretEncrypted String
  confirmedAt     DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  User            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum UserRole {
  SuperAdmin
  Admin
  User
}

enum UserStatus {
  Active
  Inactive
  Banned
  Suspended
}

enum StockMovementType {
  INITIAL
  RESTOCK
  SALE
  RETURN
  LOSS
  ADJUSTMENT
  TRANSFER
}

enum StockStatus {
  IN_STOCK
  OUT_OF_STOCK
  LOW_STOCK
}

enum ImageRole {
  COVER
  HOVER
  GALLERY
}

enum DiscountTypes {
  Percentage
  FixedValue
  FreeShipping
}

enum AppliesTo {
  AllProducts
  SpecificProducts
  SpecificCategories
}

enum AttributeTypes {
  DEFAULT
  COLOR

  @@map("AttributeTypes")
}

enum ProductPageType {
  DEFAULT
  COLOR
  SELECT
  CHECKBOX
  RATIO
}

enum FilterPageType {
  DEFAULT
  COLOR
  SELECT
  CHECKBOX
  RATIO
}

enum ProductType {
  SIMPLE
  VARIABLE
}

enum ProductStatus {
  PUBLISHED
  ARCHIVED
}

enum ProductVisibility {
  PUBLIC
  PRIVATE
}

enum OrderStatus {
  PendingPayment
  PaymentApproved
  Processing
  Shipped
  InTransit
  Completed
  OnHold
  RefundPending
  Refunded
  Canceled
}

enum RequestStatus {
  PENDING_REVIEW
  AWAITING_PAYMENT
  IN_PROGRESS
  COMPLETED
  CANCELED
}

enum ProjectType {
  LANDING_PAGE_SIMPLE
  LANDING_PAGE_CHECKOUT
  SITE_INSTITUCIONAL
  ECOMMERCE
  IDENTIDADE_VISUAL
  DASHBOARD
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELED
  COMPLETED
  NO_SHOW
}

enum KanbanPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TwoFactorMethod {
  NONE
  EMAIL
  TOTP
}
